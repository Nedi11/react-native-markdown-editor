var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:true});exports.renderRules=exports.default=void 0;var _extends2=_interopRequireDefault(require("@babel/runtime/helpers/extends"));var _slicedToArray2=_interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));var _react=_interopRequireWildcard(require("react"));var _reactNative=require("react-native");var _reactNativePellRichEditor=require("react-native-pell-rich-editor");var _markdownIt=_interopRequireDefault(require("markdown-it"));var _markdownItMathjax=_interopRequireDefault(require("markdown-it-mathjax3"));var _reactNativeMarkdownDisplay=_interopRequireDefault(require("react-native-markdown-display"));var _HtmlToMarkdownConverter=_interopRequireDefault(require("./HtmlToMarkdownConverter"));var _LatexRenderer=require("./LatexRenderer");var _this=this,_jsxFileName="/Users/sajalregmi/react-native-markdown-editor/src/MarkdownEditor.tsx";function _getRequireWildcardCache(e){if("function"!=typeof WeakMap)return null;var r=new WeakMap(),t=new WeakMap();return(_getRequireWildcardCache=function _getRequireWildcardCache(e){return e?t:r;})(e);}function _interopRequireWildcard(e,r){if(!r&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=_getRequireWildcardCache(r);if(t&&t.has(e))return t.get(e);var n={__proto__:null},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in e)if("default"!==u&&{}.hasOwnProperty.call(e,u)){var i=a?Object.getOwnPropertyDescriptor(e,u):null;i&&(i.get||i.set)?Object.defineProperty(n,u,i):n[u]=e[u];}return n.default=e,t&&t.set(e,n),n;}var markdownIt=new _markdownIt.default().use(_markdownItMathjax.default);var markdownItWithoutMathjax=new _markdownIt.default();var renderRules=exports.renderRules={math_inline:function math_inline(node,children,parent,styles){var content=node.content;return _react.default.createElement(_reactNative.Text,{key:node.key,__self:_this,__source:{fileName:_jsxFileName,lineNumber:27,columnNumber:12}},(0,_LatexRenderer.renderLatexInline)(content));},math_block:function math_block(node,children,parent,styles){var content=node.content;return _react.default.createElement(_reactNative.View,{key:node.key,style:{alignItems:'center',marginVertical:10},__self:_this,__source:{fileName:_jsxFileName,lineNumber:32,columnNumber:7}},(0,_LatexRenderer.renderLatexBlock)(content));}};var MarkdownEditor=function MarkdownEditor(_ref){var _ref$initialContent=_ref.initialContent,initialContent=_ref$initialContent===void 0?'':_ref$initialContent,onContentChange=_ref.onContentChange,_ref$editorStyles=_ref.editorStyles,editorStyles=_ref$editorStyles===void 0?{}:_ref$editorStyles,_ref$markdownStyles=_ref.markdownStyles,markdownStyles=_ref$markdownStyles===void 0?{}:_ref$markdownStyles,_ref$readOnly=_ref.readOnly,readOnly=_ref$readOnly===void 0?false:_ref$readOnly;var _useState=(0,_react.useState)(initialContent),_useState2=(0,_slicedToArray2.default)(_useState,2),content=_useState2[0],setContent=_useState2[1];var _useState3=(0,_react.useState)(''),_useState4=(0,_slicedToArray2.default)(_useState3,2),htmlContent=_useState4[0],setHtmlContent=_useState4[1];var _useState5=(0,_react.useState)(''),_useState6=(0,_slicedToArray2.default)(_useState5,2),htmlContentToConvert=_useState6[0],setHtmlContentToConvert=_useState6[1];var _useState7=(0,_react.useState)(false),_useState8=(0,_slicedToArray2.default)(_useState7,2),isEditing=_useState8[0],setIsEditing=_useState8[1];var richEditorRef=(0,_react.useRef)(null);var handleEditorChange=function handleEditorChange(html){setHtmlContent(html);};var toggleEdit=function toggleEdit(){if(isEditing){setHtmlContentToConvert(htmlContent);}else{setIsEditing(!readOnly);}};var handleConversionComplete=function handleConversionComplete(markdown){var fixedMarkdown=markdown.replace(/(\${1,2})([^$]+?)\1/g,function(match,delimiter,content){var fixedContent=content.replace(/\\\\/g,'\\');return""+delimiter+fixedContent+delimiter;});setContent(fixedMarkdown);setHtmlContentToConvert('');setIsEditing(false);if(onContentChange){onContentChange(markdown);}};(0,_react.useEffect)(function(){setContent(initialContent);},[initialContent]);return _react.default.createElement(_reactNative.View,{style:{marginBottom:20},__self:_this,__source:{fileName:_jsxFileName,lineNumber:82,columnNumber:5}},htmlContentToConvert&&_react.default.createElement(_HtmlToMarkdownConverter.default,{htmlContent:htmlContentToConvert,onConversionComplete:handleConversionComplete,__self:_this,__source:{fileName:_jsxFileName,lineNumber:85,columnNumber:9}}),isEditing?_react.default.createElement(_reactNativePellRichEditor.RichEditor,{ref:richEditorRef,initialContentHTML:markdownItWithoutMathjax.render(content),placeholder:"Start typing...",onChange:handleEditorChange,editorStyle:(0,_extends2.default)({backgroundColor:'#f5f5f5',color:'#000',contentCSSText:'font-size: 16px; color: #000;'},editorStyles),__self:_this,__source:{fileName:_jsxFileName,lineNumber:93,columnNumber:9}}):_react.default.createElement(_reactNativeMarkdownDisplay.default,{markdownit:markdownIt,rules:renderRules,style:{body:(0,_extends2.default)({color:'#000',backgroundColor:'#f5f5f5'},markdownStyles)},__self:_this,__source:{fileName:_jsxFileName,lineNumber:106,columnNumber:9}},content),!readOnly&&_react.default.createElement(_reactNative.View,{style:{flexDirection:'row',justifyContent:'flex-end',marginBottom:10},__self:_this,__source:{fileName:_jsxFileName,lineNumber:123,columnNumber:9}},_react.default.createElement(_reactNative.TouchableOpacity,{onPress:toggleEdit,__self:_this,__source:{fileName:_jsxFileName,lineNumber:124,columnNumber:11}},_react.default.createElement(_reactNative.Text,{style:{color:'blue',backgroundColor:'white',paddingHorizontal:8,paddingVertical:2,borderRadius:4,borderStyle:'solid',borderWidth:1,borderColor:'black'},__self:_this,__source:{fileName:_jsxFileName,lineNumber:125,columnNumber:13}},isEditing?'Save':'Edit'))));};var _default=exports.default=MarkdownEditor;